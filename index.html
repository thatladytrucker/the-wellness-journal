<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wellness Journal (KJV + Proverbs Affirmations)</title>
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --soft:#f9fafb;
      --accent:#2563eb;
      --accent2:#16a34a;
      --danger:#dc2626;
      --warn:#d97706;
      --shadow: 0 8px 24px rgba(17,24,39,.06);
      --radius: 16px;
      --pad: 14px;
      --max: 980px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
.fabSave{
  position: fixed;
  right: 14px;
  bottom: 80px;
  z-index: 50;
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
  padding: 12px 16px;
  border-radius: 999px;
  box-shadow: 0 10px 30px rgba(37,99,235,.25);
}
.fabSave:active{
  transform: translateY(1px);
}

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      background: var(--bg);
      color: var(--ink);
      line-height: 1.35;
    }
    header{
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .wrap{ max-width: var(--max); margin: 0 auto; padding: 14px 14px 32px; }
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 220px;
    }
    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing: .2px;
    }
    .brand .meta{
      color: var(--muted);
      font-size: 13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .pill{
      font-size: 12px;
      border:1px solid var(--border);
      background: var(--soft);
      padding: 6px 10px;
      border-radius: 999px;
      color: var(--muted);
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .controls label{
      font-size: 12px;
      color: var(--muted);
    }
    input[type="date"], input[type="datetime-local"], input[type="text"], textarea{
      font: inherit;
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      background: #fff;
      outline: none;
    }
    input[type="date"]{ padding: 8px 10px; }
    textarea{ width:100%; min-height: 120px; resize: vertical; }
    button{
      font: inherit;
      border:1px solid var(--border);
      background: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
      box-shadow: none;
    }
    button.primary{
      background: var(--accent);
      color:#fff;
      border-color: var(--accent);
    }
    button.good{
      background: var(--accent2);
      color:#fff;
      border-color: var(--accent2);
    }
    button.danger{
      background: #fff;
      color: var(--danger);
      border-color: rgba(220,38,38,.3);
    }
    button:active{ transform: translateY(1px); }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (min-width: 960px){
      .grid.two{ grid-template-columns: 1fr 1fr; }
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: var(--pad);
    }
    .card h2{
      margin:0 0 10px;
      font-size: 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card h2 .hint{
      font-size: 12px;
      color: var(--muted);
      font-weight: normal;
    }
    .sub{
      color: var(--muted);
      font-size: 13px;
      margin: 2px 0 10px;
    }
    .verseRef{
      font-family: var(--mono);
      font-size: 12.5px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .verseText{
      font-size: 15px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--soft);
      white-space: pre-wrap;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row > *{ flex: 1 1 auto; }
    .row.tight > *{ flex: 0 1 auto; }

    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 720px){
      .split{ grid-template-columns: 1fr 1fr; }
    }

    .list{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .item{
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      background: #fff;
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .item .left{ flex: 1 1 auto; min-width: 0; }
    .item .meta{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    .item .actions{
      display:flex;
      gap:8px;
      flex: 0 0 auto;
    }

    .muted{ color: var(--muted); }
    .small{ font-size: 12px; }
    .hr{ height: 1px; background: var(--border); margin: 12px 0; }

    /* 1–10 selector buttons */
    .scale{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      align-items:center;
      margin-top: 6px;
    }
    .numBtn{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-weight: 600;
      border: 1px solid var(--border);
      background: #fff;
      user-select:none;
    }
    .numBtn.sel{
      border-color: var(--accent);
      outline: 2px solid rgba(37,99,235,.15);
      background: rgba(37,99,235,.06);
    }

    .toast{
      position: fixed;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      color:#fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease;
      max-width: min(700px, calc(100vw - 24px));
      text-align:center;
    }
    .toast.show{ opacity: 1; }

    .footerRow{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 14px;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>Wellness Journal</h1>
  // ~~function setSaveStatus(txt){
// ~~  const el = document.getElementById("saveStatus");
// ~~  if(el) el.textContent = txt;
// ~~}~~
function setSaveStatus(txt){
  // removed (no save status pill)
}

      </div>

      <div class="controls">
        <div class="row tight">
          <label for="viewDate">View date</label>
          <input id="viewDate" type="date" />
          <button id="btnToday" title="Jump back to today">Today</button>
        </div>
        <!-- ~~<button class="primary" id="btnSaveAll">Save</button>~~ -->
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <!-- DAILY VERSE -->
    <section class="card" aria-labelledby="verseTitle">
      <h2 id="verseTitle">
        Daily Bible Verse (KJV)
        <span class="hint">Auto-rotates daily</span>
      </h2>
      <div class="verseRef" id="verseRef">—</div>
      <div class="verseText" id="verseText">—</div>
      <div class="footerRow">
        <div class="kbd">Tip: This is based on the day of the year, so it changes each day.</div>
        <button id="btnNewVerse">Show another verse</button>
      </div>
    </section>

    <!-- DAILY JOURNAL -->
    <section class="card" aria-labelledby="journalTitle">
      <h2 id="journalTitle">
        Daily Journal
        <span class="hint">Add throughout the day</span>
      </h2>
      <div class="sub">Type below, then press <b>Add Entry</b>. You can add as many entries as you want.</div>

      <textarea id="journalInput" placeholder="Write what’s on your mind... (this draft auto-saves)"></textarea>

      <div class="row" style="margin-top:10px;">
        <button class="good" id="btnAddJournal">Add Entry</button>
        <button class="danger" id="btnClearDraft" title="Clears ONLY the draft box (does not delete saved entries)">Clear Draft</button>
      </div>

      <div class="hr"></div>
      <div class="sub">Saved entries for <span id="journalDateLabel"></span>:</div>
      <div class="list" id="journalList"></div>
      <div class="small muted" id="journalEmpty" style="display:none;">No saved journal entries for this date yet.</div>
    </section>

    <!-- GOALS -->
    <section class="card" aria-labelledby="goalsTitle">
      <h2 id="goalsTitle">
        One Small Intention (Goals)
        <span class="hint">Incomplete goals carry forward</span>
      </h2>
      <div class="sub">Add your main intention. You can add more goals. If you don’t finish today, it will still be here tomorrow.</div>

      <div class="row">
        <input id="goalInput" type="text" placeholder="Example: Drink water / Call doctor / 10-min walk" />
        <button class="good" id="btnAddGoal">Add</button>
      </div>

      <div class="hr"></div>
      <div class="sub">Active goals:</div>
      <div class="list" id="goalsList"></div>
      <div class="small muted" id="goalsEmpty" style="display:none;">No active goals right now.</div>

      <div class="hr"></div>
      <div class="sub">Completed goals:</div>
      <div class="list" id="goalsDoneList"></div>
      <div class="small muted" id="goalsDoneEmpty" style="display:none;">No completed goals yet.</div>
    </section>

    <!-- CHECK-INS -->
    <section class="card" aria-labelledby="mhTitle">
      <h2 id="mhTitle">
        Mental Health Check-ins
        <span class="hint">Add multiple check-ins per day</span>
      </h2>
      <div class="split">

        <div>
          <div class="sub"><b>Overall Depression (1–10)</b></div>
          <div class="scale" id="depScale"></div>
        </div>

        <div>
          <div class="sub"><b>Overall Anxiety (1–10)</b></div>
          <div class="scale" id="anxScale"></div>
        </div>

      </div>

      <div style="margin-top:10px;">
        <div class="sub">Optional note (what happened / why you feel this way):</div>
        <input id="mhNote" type="text" placeholder="Optional reason..." />
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="good" id="btnAddCheckin">Add Check-in</button>
        <button class="danger" id="btnClearCheckin">Clear Check-in</button>
      </div>

      <div class="hr"></div>
      <div class="sub">Saved check-ins for <span id="mhDateLabel"></span>:</div>
      <div class="list" id="mhList"></div>
      <div class="small muted" id="mhEmpty" style="display:none;">No check-ins for this date yet.</div>
    </section>

    <!-- APPOINTMENTS + FOLLOWUPS -->
    <section class="card" aria-labelledby="apptTitle">
      <h2 id="apptTitle">
        Appointments
        <span class="hint">Title • Date/Time • Location • Notes</span>
      </h2>

      <div class="split">
        <input id="apptTitleInput" type="text" placeholder="Appointment title (example: Therapy / Doctor / Dentist)" />
        <input id="apptDateTimeInput" type="datetime-local" />
      </div>
      <div class="split" style="margin-top:10px;">
        <input id="apptLocationInput" type="text" placeholder="Location (optional)" />
        <input id="apptNotesInput" type="text" placeholder="Notes (optional)" />
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="good" id="btnAddAppt">Add Appointment</button>
        <button class="danger" id="btnClearAppt">Clear</button>
      </div>

      <div class="hr"></div>
      <div class="sub">Your appointments (all dates):</div>
      <div class="list" id="apptList"></div>
      <div class="small muted" id="apptEmpty" style="display:none;">No appointments saved yet.</div>

      <div class="hr"></div>

      <h2 style="margin-top:0;">
        Follow-ups
        <span class="hint">Contact Name • Follow-up Notes</span>
      </h2>

      <div class="split">
        <input id="fuNameInput" type="text" placeholder="Contact name (example: Dr. Lane / HR / Caseworker)" />
        <input id="fuNotesInput" type="text" placeholder="Follow-up notes (what you need / what to ask)" />
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="good" id="btnAddFU">Add Follow-up</button>
        <button class="danger" id="btnClearFU">Clear</button>
      </div>

      <div class="hr"></div>
      <div class="sub">Follow-ups:</div>
      <div class="list" id="fuList"></div>
      <div class="small muted" id="fuEmpty" style="display:none;">No follow-ups saved yet.</div>
    </section>

    <!-- DAILY AFFIRMATION -->
    <section class="card" aria-labelledby="affTitle">
      <h2 id="affTitle">
        Daily Affirmation (Proverbs-based)
        <span class="hint">Auto-rotates daily</span>
      </h2>
      <div class="verseText" id="affText">—</div>
      <div class="footerRow">
        <div class="kbd">Tip: This rotates daily (Day-of-Year).</div>
        <button id="btnNewAff">Show another affirmation</button>
      </div>
    </section>

    <section class="card">
      <h2>
        Backup (Optional)
        <span class="hint">Export your data</span>
      </h2>
      <div class="sub">If you ever need to save a backup, you can export your data as a JSON file and store it in Google Drive.</div>
      <div class="row">
        <button id="btnExport">Export JSON</button>
        <button class="danger" id="btnHardReset" title="Deletes all saved data">Hard Reset (Delete Everything)</button>
      </div>
      <div class="small muted" style="margin-top:10px;">
        This app stores your data only on this device/browser (local storage). No cloud. No account.
      </div>
    </section>

  </div>
</main>

<div class="toast" id="toast"></div>

<script>
/* =========================
   DATA: KJV VERSES (fear list)
   ========================= */

const KJV_VERSES_FEAR = [
  { ref: "Genesis 15:1", text: "After these things the word of the Lord came unto Abram in a vision, saying, Fear not, Abram: I am thy shield, and thy exceeding great reward." },
  { ref: "Genesis 21:17", text: "And God heard the voice of the lad; and the angel of God called to Hagar out of heaven, and said unto her, What aileth thee, Hagar? fear not; for God hath heard the voice of the lad where he is." },
  { ref: "Genesis 26:24", text: "And the Lord appeared unto him the same night, and said, I am the God of Abraham thy father: fear not, for I am with thee, and will bless thee..." },
  { ref: "Genesis 35:17", text: "And it came to pass, when she was in hard labour, that the midwife said unto her, Fear not; thou shalt have this son also." },
  { ref: "Genesis 43:23", text: "And he said, Peace be to you, fear not: your God, and the God of your father, hath given you treasure in your sacks..." },
  { ref: "Genesis 46:3", text: "And he said, I am God, the God of thy father: fear not to go down into Egypt; for I will there make of thee a great nation." },
  { ref: "Genesis 50:19", text: "And Joseph said unto them, Fear not: for am I in the place of God?" },
  { ref: "Genesis 50:21", text: "Now therefore fear ye not: I will nourish you, and your little ones. And he comforted them, and spake kindly unto them." },

  { ref: "Exodus 14:13", text: "And Moses said unto the people, Fear ye not, stand still, and see the salvation of the Lord, which he will shew to you to day..." },
  { ref: "Exodus 20:20", text: "And Moses said unto the people, Fear not: for God is come to prove you, and that his fear may be before your faces, that ye sin not." },

  { ref: "Numbers 14:9", text: "Only rebel not ye against the Lord, neither fear ye the people of the land... the Lord is with us: fear them not." },
  { ref: "Numbers 21:34", text: "And the Lord said unto Moses, Fear him not: for I have delivered him into thy hand, and all his people, and his land..." },

  { ref: "Deuteronomy 1:21", text: "...go up and possess it, as the Lord God of thy fathers hath said unto thee; fear not, neither be discouraged." },
  { ref: "Deuteronomy 3:2", text: "And the Lord said unto me, Fear him not: for I will deliver him, and all his people, and his land, into thy hand..." },
  { ref: "Deuteronomy 3:22", text: "Ye shall not fear them: for the Lord your God he shall fight for you." },
  { ref: "Deuteronomy 31:6", text: "Be strong and of a good courage, fear not, nor be afraid of them: for the Lord thy God, he it is that doth go with thee; he will not fail thee, nor forsake thee." },
  { ref: "Deuteronomy 31:8", text: "And the Lord, he it is that doth go before thee... fear not, neither be dismayed." },

  { ref: "Joshua 1:9", text: "Have not I commanded thee? Be strong and of a good courage; be not afraid, neither be thou dismayed: for the Lord thy God is with thee whithersoever thou goest." },
  { ref: "Joshua 8:1", text: "And the Lord said unto Joshua, Fear not, neither be thou dismayed: take all the people of war with thee, and arise, go up to Ai..." },
  { ref: "Joshua 10:8", text: "And the Lord said unto Joshua, Fear them not: for I have delivered them into thine hand..." },
  { ref: "Joshua 10:25", text: "And Joshua said unto them, Fear not, nor be dismayed, be strong and of good courage..." },

  { ref: "Judges 4:18", text: "And Jael went out to meet Sisera, and said unto him, Turn in, my lord, turn in to me; fear not." },
  { ref: "Judges 6:23", text: "And the Lord said unto him, Peace be unto thee; fear not: thou shalt not die." },

  { ref: "Ruth 3:11", text: "And now, my daughter, fear not; I will do to thee all that thou requirest..." },

  { ref: "1 Samuel 12:20", text: "And Samuel said unto the people, Fear not: ye have done all this wickedness: yet turn not aside from following the Lord..." },
  { ref: "1 Samuel 22:23", text: "Abide thou with me, fear not: for he that seeketh my life seeketh thy life: but with me thou shalt be in safeguard." },
  { ref: "1 Samuel 23:17", text: "And he said unto him, Fear not: for the hand of Saul my father shall not find thee..." },

  { ref: "2 Samuel 9:7", text: "And David said unto him, Fear not: for I will surely shew thee kindness for Jonathan thy father's sake..." },
  { ref: "2 Samuel 13:28", text: "...when I say unto you, Smite Amnon; then kill him, fear not: have not I commanded you? be courageous, and be valiant." },

  { ref: "1 Kings 17:13", text: "And Elijah said unto her, Fear not; go and do as thou hast said: but make me thereof a little cake first..." },

  { ref: "2 Kings 1:15", text: "And the angel of the Lord said unto Elijah, Go down with him: be not afraid of him." },
  { ref: "2 Kings 6:16", text: "And he answered, Fear not: for they that be with us are more than they that be with them." },
  { ref: "2 Kings 19:6", text: "...Be not afraid of the words which thou hast heard, with which the servants of the king of Assyria have blasphemed me." },
  { ref: "2 Kings 25:24", text: "...Fear not to be the servants of the Chaldees: dwell in the land, and serve the king of Babylon; and it shall be well with you." },

  { ref: "1 Chronicles 22:13", text: "...be strong, and of good courage; dread not, nor be dismayed." },
  { ref: "1 Chronicles 28:20", text: "...Be strong and of good courage, and do it: fear not, nor be dismayed: for the Lord God, even my God, will be with thee..." },

  { ref: "2 Chronicles 20:15", text: "...Thus saith the Lord unto you, Be not afraid nor dismayed by reason of this great multitude; for the battle is not yours, but God's." },
  { ref: "2 Chronicles 20:17", text: "...stand ye still, and see the salvation of the Lord with you... fear not, nor be dismayed; to morrow go out against them: for the Lord will be with you." },
  { ref: "2 Chronicles 32:7", text: "Be strong and courageous, be not afraid nor dismayed for the king of Assyria... for there be more with us than with him." },

  { ref: "Nehemiah 4:14", text: "...be not ye afraid of them: remember the Lord, which is great and terrible, and fight for your brethren..." },

  { ref: "Psalm 23:4", text: "Yea, though I walk through the valley of the shadow of death, I will fear no evil: for thou art with me; thy rod and thy staff they comfort me." },
  { ref: "Psalm 27:1", text: "The Lord is my light and my salvation; whom shall I fear? the Lord is the strength of my life; of whom shall I be afraid?" },
  { ref: "Psalm 27:14", text: "Wait on the Lord: be of good courage, and he shall strengthen thine heart: wait, I say, on the Lord." },
  { ref: "Psalm 31:24", text: "Be of good courage, and he shall strengthen your heart, all ye that hope in the Lord." },
  { ref: "Psalm 49:16", text: "Be not thou afraid when one is made rich, when the glory of his house is increased." },
  { ref: "Psalm 56:3", text: "What time I am afraid, I will trust in thee." },

  { ref: "Proverbs 3:25", text: "Be not afraid of sudden fear, neither of the desolation of the wicked, when it cometh." },

  { ref: "Isaiah 7:4", text: "...Take heed, and be quiet; fear not, neither be fainthearted..." },
  { ref: "Isaiah 10:24", text: "...O my people that dwellest in Zion, be not afraid of the Assyrian..." },
  { ref: "Isaiah 12:2", text: "Behold, God is my salvation; I will trust, and not be afraid..." },
  { ref: "Isaiah 35:4", text: "Say to them that are of a fearful heart, Be strong, fear not: behold, your God will come with vengeance..." },
  { ref: "Isaiah 37:6", text: "...Thus saith the Lord, Be not afraid of the words that thou hast heard..." },
  { ref: "Isaiah 40:9", text: "...lift up thy voice with strength; lift it up, be not afraid; say unto the cities of Judah, Behold your God!" },
  { ref: "Isaiah 41:10", text: "Fear thou not; for I am with thee: be not dismayed; for I am thy God: I will strengthen thee; yea, I will help thee..." },
  { ref: "Isaiah 41:13", text: "For I the Lord thy God will hold thy right hand, saying unto thee, Fear not; I will help thee." },
  { ref: "Isaiah 41:14", text: "Fear not, thou worm Jacob, and ye men of Israel; I will help thee, saith the Lord..." },
  { ref: "Isaiah 43:1", text: "...Fear not: for I have redeemed thee, I have called thee by thy name; thou art mine." },
  { ref: "Isaiah 43:5", text: "Fear not: for I am with thee: I will bring thy seed from the east, and gather thee from the west." },
  { ref: "Isaiah 44:2", text: "...Fear not, O Jacob, my servant; and thou, Jesurun, whom I have chosen." },
  { ref: "Isaiah 44:8", text: "Fear ye not, neither be afraid: have not I told thee from that time, and have declared it? ye are even my witnesses." },
  { ref: "Isaiah 51:7", text: "...fear ye not the reproach of men, neither be ye afraid of their revilings." },
  { ref: "Isaiah 54:4", text: "Fear not; for thou shalt not be ashamed: neither be thou confounded; for thou shalt not be put to shame..." },

  { ref: "Jeremiah 1:8", text: "Be not afraid of their faces: for I am with thee to deliver thee, saith the Lord." },
  { ref: "Jeremiah 1:17", text: "...arise, and speak unto them all that I command thee: be not dismayed at their faces, lest I confound thee before them." },
  { ref: "Jeremiah 10:5", text: "...be not afraid of them; for they cannot do evil, neither also is it in them to do good." },
  { ref: "Jeremiah 30:10", text: "Therefore fear thou not, O my servant Jacob, saith the Lord; neither be dismayed, O Israel..." },
  { ref: "Jeremiah 42:11", text: "Be not afraid of the king of Babylon... for I am with you to save you, and to deliver you from his hand." },
  { ref: "Jeremiah 46:27", text: "But fear not thou, O my servant Jacob, and be not dismayed, O Israel: for, behold, I will save thee from afar off..." },
  { ref: "Jeremiah 46:28", text: "Fear thou not, O Jacob my servant, saith the Lord: for I am with thee..." },

  { ref: "Lamentations 3:57", text: "Thou drewest near in the day that I called upon thee: thou saidst, Fear not." },

  { ref: "Ezekiel 2:6", text: "...be not afraid of them, neither be afraid of their words... nor be dismayed at their looks..." },
  { ref: "Ezekiel 3:9", text: "...fear them not, neither be dismayed at their looks, though they be a rebellious house." },

  { ref: "Obadiah 1:9", text: "And thy mighty men, O Teman, shall be dismayed..." },

  { ref: "Joel 2:21", text: "Fear not, O land; be glad and rejoice: for the Lord will do great things." },
  { ref: "Joel 2:22", text: "Be not afraid, ye beasts of the field: for the pastures of the wilderness do spring..." },

  { ref: "Zephaniah 3:16", text: "In that day it shall be said to Jerusalem, Fear thou not: and to Zion, Let not thine hands be slack." },
  { ref: "Haggai 2:5", text: "According to the word that I covenanted with you when ye came out of Egypt, so my spirit remaineth among you: fear ye not." },
  { ref: "Zechariah 8:13", text: "...so will I save you, and ye shall be a blessing: fear not, but let your hands be strong." },
  { ref: "Zechariah 8:15", text: "So again have I thought in these days to do well unto Jerusalem and to the house of Judah: fear ye not." },

  { ref: "Matthew 1:20", text: "...Joseph, thou son of David, fear not to take unto thee Mary thy wife..." },
  { ref: "Matthew 10:28", text: "And fear not them which kill the body, but are not able to kill the soul..." },
  { ref: "Matthew 14:27", text: "Be of good cheer; it is I; be not afraid." },
  { ref: "Matthew 17:7", text: "Arise, and be not afraid." },
  { ref: "Matthew 28:5", text: "Fear not ye: for I know that ye seek Jesus, which was crucified." },
  { ref: "Matthew 28:10", text: "Be not afraid: go tell my brethren that they go into Galilee, and there shall they see me." },

  { ref: "Mark 5:36", text: "Be not afraid, only believe." },
  { ref: "Mark 6:50", text: "Be of good cheer: it is I; be not afraid." },

  { ref: "Luke 1:13", text: "Fear not, Zacharias: for thy prayer is heard..." },
  { ref: "Luke 1:30", text: "Fear not, Mary: for thou hast found favour with God." },
  { ref: "Luke 2:10", text: "Fear not: for, behold, I bring you good tidings of great joy..." },
  { ref: "Luke 5:10", text: "Fear not; from henceforth thou shalt catch men." },
  { ref: "Luke 8:50", text: "Fear not: believe only, and she shall be made whole." },
  { ref: "Luke 12:4", text: "Be not afraid of them that kill the body..." },
  { ref: "Luke 12:7", text: "Fear not therefore: ye are of more value than many sparrows." },
  { ref: "Luke 12:32", text: "Fear not, little flock; for it is your Father's good pleasure to give you the kingdom." },

  { ref: "John 6:20", text: "It is I; be not afraid." },
  { ref: "John 12:15", text: "Fear not, daughter of Sion: behold, thy King cometh..." },
  { ref: "John 14:27", text: "Let not your heart be troubled, neither let it be afraid." },

  { ref: "Acts 18:9", text: "Be not afraid, but speak, and hold not thy peace." },
  { ref: "Acts 27:24", text: "Fear not, Paul; thou must be brought before Caesar..." },

  { ref: "1 Peter 3:14", text: "...be not afraid of their terror, neither be troubled." },
  { ref: "2 Timothy 1:7", text: "For God hath not given us the spirit of fear; but of power, and of love, and of a sound mind." },
  { ref: "Revelation 1:17", text: "Fear not; I am the first and the last." }
];

/* =========================
   DATA: 365 AFFIRMATIONS
   ========================= */

const AFFIRMATIONS_365 = [
  "I welcome wisdom into my life.",
  "I seek understanding instead of confusion.",
  "I receive instruction that helps me live rightly.",
  "I honor God as the beginning of all wisdom.",
  "I am teachable and willing to grow.",
  "I listen when wisdom calls out to me.",
  "I turn away from people whose choices lead to harm.",
  "I protect my peace by avoiding traps set by others.",
  "I value the counsel of trustworthy voices.",
  "I do not join in violence, chaos, or foolishness.",
  "I choose patience and prudence.",
  "I am alert and not easily deceived.",
  "I practice discernment in every decision.",
  "I do not ignore warning signs.",
  "I listen when God corrects me because it keeps me safe.",
  "I trust that wisdom increases my days and strengthens my path.",
  "I refuse to let fear guide my decisions.",
  "I walk away from conversations that pull me off my purpose.",
  "I honor the lessons taught by the elders before me.",
  "I guard my steps carefully.",
  "I am responsible for the choices I make.",
  "I ask God for clarity when I feel lost.",
  "I am not tempted by shortcuts or false promises.",
  "I value peace over popularity.",
  "I allow wisdom to protect me from danger.",
  "I am steady, grounded, and secure.",
  "I do not entertain the voices of the wicked.",
  "I listen for God’s direction every day.",
  "I learn from my mistakes and move forward.",
  "I seek the knowledge that leads to life.",
  "I stay mindful of the paths I choose.",
  "I trust that God answers when I call.",
  "I rest in the safety that comes from living wisely.",
  "I receive God’s wisdom with an open heart.",
  "I treasure understanding because it protects me.",
  "I listen closely for wisdom and insight.",
  "I seek God’s knowledge the way others seek treasure.",
  "I understand what is right, just, and fair.",
  "I walk on paths of righteousness and safety.",
  "I am protected from people who twist truth or deceive.",
  "I stay away from choices that lead to darkness or harm.",
  "I use discretion to guard my steps.",
  "I stay grounded so I am not pulled into destructive situations.",
  "I walk in integrity and remain rooted in God’s wisdom.",
  "I trust in the Lord with all my heart.",
  "I do not lean on my own understanding.",
  "I acknowledge God in all my ways, and He guides my path.",
  "I choose wisdom over fear and confusion.",
  "I turn away from evil so my body and mind can heal.",
  "I honor God with what I have and what I earn.",
  "I am not wise in my own eyes — I am teachable.",
  "I welcome correction that protects my future.",
  "I seek wisdom because she brings peace, joy, and long life.",
  "I guard kindness and truth so they never leave me.",
  "I keep sound judgment so my steps stay secure.",
  "I rest in the safety God provides at night and in the daytime.",
  "I hold on to wisdom because it is life to me.",
  "I guard my heart because it directs everything I do.",
  "I stay on the path God has set for me.",
  "I do not abandon the lessons that protect my future.",
  "I turn away from evil and anything that pulls me off my path.",
  "I walk in light, not in confusion or darkness.",
  "I stay teachable and open to correction.",
  "I keep my eyes straight ahead and focused on purpose.",
  "I choose words that bring life and clarity.",
  "I stay steady and intentional with every step I take.",
  "I listen closely to wisdom so I can stay protected.",
  "I am alert to voices and situations that seem sweet but lead to harm.",
  "I honor my body, my mind, and my future with disciplined choices.",
  "I turn away from anything that drains my strength or peace.",
  "I stay far from paths that pull me into regret.",
  "I value the life and purpose God has given me.",
  "I refuse to give my energy, time, or joy to destructive people.",
  "I protect my personal boundaries with confidence.",
  "I choose actions that support long-term stability and wholeness.",
  "I walk in wisdom today so I do not look back in sorrow tomorrow.",
  "I protect myself by making wise agreements and commitments.",
  "I do not rush into obligations that trap my peace.",
  "I take responsibility for fixing mistakes quickly.",
  "I work diligently and prepare for the future.",
  "I avoid laziness because my purpose needs my attention.",
  "I stay away from people who stir up conflict or disorder.",
  "I recognize warning signs and adjust before harm happens.",
  "I refuse to engage in deceit, manipulation, or destructive behavior.",
  "I walk with integrity because it brings peace and protection.",
  "I honor the wisdom passed down from my parents and elders.",
  "I resist temptation that leads to regret or loss.",
  "I guard my heart, my body, and my future with God’s wisdom.",
  "I keep God’s commands close to my heart.",
  "I protect myself by storing wisdom deep within me.",
  "I stay alert to voices and situations that try to pull me off my purpose.",
  "I recognize temptation early and turn away quickly.",
  "I do not go near places or people that threaten my peace.",
  "I choose discipline over impulsive decisions.",
  "I value long-term stability more than momentary pleasure.",
  "I guard my steps so I don’t wander into danger.",
  "I use discernment in relationships and connections.",
  "I let wisdom guide my emotions, thoughts, and actions.",
  "I stay grounded in truth so I am not led astray.",
  "I listen when wisdom calls because her voice leads me to life.",
  "I choose understanding over confusion and chaos.",
  "I speak truth and reject anything that twists or distorts it.",
  "I walk in righteousness and fairness.",
  "I value wisdom more than gold, silver, or anything money can buy.",
  "I use good judgment in all my decisions.",
  "I stay aware of the paths that lead to peace.",
  "I am protected because I love and pursue wisdom.",
  "I receive instruction that brings honor and stability.",
  "I stay in alignment with God’s ways, which lead to life.",
  "I embrace the blessings that come from choosing wisdom daily.",
  "I find favor with the Lord by listening and obeying His wisdom.",
  "I accept wisdom’s invitation because it leads to life.",
  "I walk in understanding, not confusion.",
  "I welcome correction because it makes me wiser.",
  "I surround myself with people who value truth.",
  "I turn away from foolishness that steals my peace.",
  "I choose the path that leads to growth and stability.",
  "I fear the Lord, and that gives me wisdom and direction.",
  "I build my life on choices that bring honor, clarity, and long life.",
  "I walk in righteousness, and it brings me stability.",
  "I speak words that give life, not harm.",
  "I work diligently and trust that God blesses my efforts.",
  "I choose wisdom over reckless behavior.",
  "I guard my mouth because my words carry power.",
  "I act with integrity even when no one is watching.",
  "I bring joy to others through my choices and my character.",
  "I avoid foolishness because it steals peace and creates turmoil.",
  "I live in the safety and peace that wisdom provides.",
  "I walk in integrity, and integrity protects me.",
  "I choose honesty, even when it’s hard.",
  "Humility opens the door for wisdom in my life.",
  "My words carry power, and I use them to build, not destroy.",
  "I release pride and make room for clarity.",
  "I surround myself with wise voices and safe guidance.",
  "I am trustworthy, and people can rely on my word.",
  "I guard my heart by guarding my speech.",
  "My kindness returns to me multiplied.",
  "I do not carry other people’s chaos or debts.",
  "I set boundaries that protect my peace and purpose.",
  "I sow good seeds and I receive good in return.",
  "I am guided by truth, not by fear or pressure.",
  "Peace grows in my life when I act with integrity.",
  "I release negative cycles that no longer serve me.",
  "I attract favor when I seek what is good.",
  "I am steady, grounded, and anchored in wisdom.",
  "I choose generosity over scarcity.",
  "I let go of gossip, drama, and confusion.",
  "My honest choices create a safe and stable future.",
  "I am protected from the traps set by others.",
  "I am not shaken by wickedness or negativity.",
  "I use my influence to uplift and strengthen.",
  "I stay rooted in what is right, even when others are not.",
  "I trust that consequences work themselves out without my involvement.",
  "I walk confidently because my heart is aligned with truth.",
  "I am free from foolish decisions and reckless promises.",
  "I practice self-control in my reactions and responses.",
  "I am a light of integrity in every environment I enter.",
  "I choose what leads to life, peace, and stability every single day.",
  "I love discipline because it helps me grow wiser.",
  "I practice integrity because it strengthens my foundation.",
  "I choose truth and reject anything deceitful.",
  "I use my words to heal, uplift, and bring clarity.",
  "I work diligently and honor the gifts God placed in me.",
  "I guard my heart from anxious thoughts by seeking wisdom.",
  "I act righteously, knowing it brings favor and stability.",
  "I stay grounded and calm because God establishes my steps.",
  "I pursue wisdom that leads to a peaceful, secure life.",
  "I receive discipline because it protects my future.",
  "I walk with wise people so I can grow wiser.",
  "I guard my words because they shape my life.",
  "I choose steady, honest work over shortcuts and regret.",
  "I manage my anger so it doesn’t control my decisions.",
  "I honor my responsibilities and see the blessings of consistency.",
  "I pursue wisdom because it leads to life and abundance.",
  "I stay grounded and patient, trusting that good results come with time.",
  "I build my life with wisdom, not impulsive decisions.",
  "I stay calm and patient because a peaceful spirit brings clarity.",
  "I choose understanding over quick reactions.",
  "I walk uprightly, and God strengthens my steps.",
  "I turn away from foolishness that leads to trouble.",
  "I am slow to anger because anger clouds judgment.",
  "I show kindness because it honors God and protects my heart.",
  "I stay grounded and steady even when others choose chaos.",
  "I choose righteousness because it leads to life, stability, and honor.",
  "I use gentle words that calm and restore, not words that stir anger.",
  "I seek knowledge before responding.",
  "I keep my heart open to correction because it helps me grow.",
  "I live with integrity, knowing God sees my intentions.",
  "I choose a cheerful heart that brings life to my spirit.",
  "I avoid pride because humility brings understanding.",
  "I listen to wise counsel instead of reacting impulsively.",
  "I stay slow to anger because it leads to peace and clarity.",
  "I walk in righteousness, which brings joy and favor.",
  "I choose paths that lead to peace, wisdom, and stability.",
  "I commit my plans to the Lord, and He establishes my steps.",
  "I keep my motives pure and honest before God.",
  "I stay humble because humility brings wisdom and honor.",
  "I turn away from evil because righteousness protects my life.",
  "I choose peaceful responses instead of angry reactions.",
  "I speak with grace and truth, knowing my words carry weight.",
  "I rely on God’s guidance, not my own understanding.",
  "I make decisions that reflect integrity and sound judgment.",
  "I stay patient because God works everything together in His time.",
  "I pursue wisdom because it is better than wealth.",
  "I guard my spirit so pride does not lead me into destruction.",
  "I walk confidently because the Lord directs my steps.",
  "I choose peace over conflict, even when others choose chaos.",
  "I stay calm because wisdom grows in stillness.",
  "I guard my words so they bring clarity and not harm.",
  "I walk in integrity, which strengthens my life and reputation.",
  "I am slow to anger because patience protects my spirit.",
  "I turn away from foolishness and stay grounded in understanding.",
  "I show love and loyalty because they reflect God’s heart.",
  "I protect my peace by avoiding unnecessary arguments.",
  "I listen before responding so I can speak with wisdom.",
  "I use discernment to stay away from harmful people and situations.",
  "I keep my heart steady and wise in every season.",
  "I seek understanding before I speak.",
  "I guard my words because they carry power and consequence.",
  "I avoid gossip and conversations that bring division.",
  "I run to the Lord as my strong tower and place of safety.",
  "I stay humble because pride leads to destruction.",
  "I listen carefully so I can answer wisely.",
  "I choose friends who strengthen my spirit and character.",
  "I stay patient and avoid reacting out of impulse.",
  "I speak life, healing, and truth into every situation.",
  "I use discernment to stay grounded and wise.",
  "I remain aware that my tongue can build up or tear down — I choose to build.",
  "I walk in integrity because it protects my life and my name.",
  "I stay patient because rushing leads to mistakes and regret.",
  "I choose wisdom over impulsive decisions.",
  "I receive correction because it guides me toward growth.",
  "I avoid anger because calm thinking brings clarity.",
  "I show kindness because the Lord blesses those who care for the poor.",
  "I use discernment so I won’t be misled.",
  "I honor God’s plans, knowing they stand firm over my life.",
  "I am not swayed by false words or careless talk.",
  "I keep learning so wisdom can guide my path.",
  "I choose steady, thoughtful living that leads to peace.",
  "I practice self-control because it strengthens my wisdom and stability.",
  "I avoid impulsive decisions that lead to regret.",
  "I walk in integrity, and my integrity guides my steps.",
  "I listen carefully before responding so my words reflect wisdom.",
  "I stay away from unnecessary conflict and choose peace.",
  "I am diligent because steady effort leads to reward.",
  "I act with honesty and fairness in all my dealings.",
  "I seek counsel because wise guidance strengthens my decisions.",
  "I trust the Lord to search my heart and keep me on the right path.",
  "I remain calm and patient in stressful situations.",
  "I value righteousness because it brings protection and clarity.",
  "I trust that the Lord directs my heart and guides my steps.",
  "I value righteousness and justice because they please God.",
  "I examine my motives to keep them pure and honorable.",
  "I choose diligence over excuses because steady effort brings results.",
  "I guard my mouth so my words create peace, not strife.",
  "I avoid rushing into conflict because wisdom stays calm.",
  "I walk humbly, knowing pride leads to downfall.",
  "I seek wisdom instead of relying on my own strength.",
  "I stay focused on what leads to life, peace, and stability.",
  "I honor God with my decisions and my daily actions.",
  "I trust that true victory comes from the Lord.",
  "I protect my good name because it is more valuable than riches.",
  "I walk in humility because humility brings honor and life.",
  "I choose wise paths and avoid traps that harm my future.",
  "I train my heart in wisdom so I will not depart from it.",
  "I stay away from angry, hot-tempered people to protect my peace.",
  "I handle my finances with honesty and fairness.",
  "I speak truth and refuse to twist my words to deceive.",
  "I am diligent in my work because diligence leads to opportunity.",
  "I defend the vulnerable and honor those God cares for.",
  "I maintain healthy boundaries to guard my well-being.",
  "I seek knowledge and instruction so I can walk securely.",
  "I use wisdom when making choices, especially around temptation.",
  "I stay aware of influences that try to pull me off my path.",
  "I guard my heart from envy and comparison.",
  "I discipline myself because discipline brings freedom.",
  "I honor the guidance of wise voices in my life.",
  "I keep my mind clear and avoid anything that clouds my judgment.",
  "I stay grounded so cravings and impulses don’t control me.",
  "I focus on what builds my future instead of draining my strength.",
  "I align my heart with truth, not deception or distraction.",
  "I invest in wisdom because it brings long-term peace.",
  "I walk in self-control because it leads to life and stability.",
  "I do not envy the wicked or desire their paths.",
  "I build my life with wisdom, understanding, and knowledge.",
  "I stay strong in adversity because God is my strength.",
  "I choose wise counsel before making decisions.",
  "I refuse to participate in evil or injustice.",
  "I remain calm and steady when facing trouble.",
  "I stand up for those who cannot defend themselves.",
  "I keep my heart from discouragement because my hope is in God.",
  "I learn from correction so I can grow wiser.",
  "I stay disciplined and avoid wasting my energy.",
  "I walk in righteousness because it leads to a secure future.",
  "I use patience because patience brings clarity and peace.",
  "I choose gentle words that cool anger and open understanding.",
  "I avoid unnecessary conflict and stay focused on purpose.",
  "I stay humble because humility brings honor.",
  "I act with self-control even when my emotions are strong.",
  "I guard my heart from impulsive reactions.",
  "I seek wisdom before making important decisions.",
  "I show kindness generously and without expectation.",
  "I remain calm in heated situations because calmness is strength.",
  "I carry myself with dignity and discipline in every environment.",
  "I maintain healthy boundaries to protect my peace.",
  "I stay away from foolish behavior that brings unnecessary trouble.",
  "I refuse to get pulled into arguments that go nowhere.",
  "I guard my words and choose truth over exaggeration or deceit.",
  "I stay focused on my purpose instead of distractions.",
  "I avoid people who stir up chaos and confusion.",
  "I protect my peace by stepping away from toxic conversations.",
  "I practice self-control because it strengthens my character.",
  "I recognize manipulation and do not fall into its traps.",
  "I choose honesty, clarity, and integrity in all situations.",
  "I stay grounded and steady, even when others choose foolishness.",
  "I do not boast about tomorrow; I stay present and grounded in today.",
  "I welcome honest feedback because it sharpens my character.",
  "I choose friendships that challenge me to grow wiser and stronger.",
  "I manage my emotions with wisdom instead of reacting impulsively.",
  "I guard my heart from envy and comparison.",
  "I avoid unnecessary conflict and choose peace whenever possible.",
  "I stay diligent in my responsibilities because diligence brings stability.",
  "I value loyalty and faithfulness in my relationships.",
  "I keep my heart aligned with wisdom to avoid foolish decisions.",
  "I remain steady and trustworthy in all seasons of life.",
  "I walk in boldness because righteousness makes me confident.",
  "I refuse to hide from truth — I face it with courage.",
  "I choose honesty over gain that comes from wrongdoing.",
  "I stay faithful because faithfulness brings blessings.",
  "I avoid impulsive decisions and seek wisdom first.",
  "I do not let fear or anxiety drive my choices.",
  "I walk in justice and protect those who are vulnerable.",
  "I confess mistakes quickly so healing and direction can come.",
  "I trust that God will supply what I need when I live uprightly.",
  "I stay grounded in wisdom so I won’t be shaken.",
  "I receive correction with humility because it protects my future.",
  "I stay calm and self-controlled even when others lose their tempers.",
  "I refuse to be controlled by fear, anger, or impulse.",
  "I listen before speaking so my words bring wisdom and peace.",
  "I walk in justice because it brings stability to my life.",
  "I avoid people who stir up conflict or encourage chaos.",
  "I guard my heart from pride because pride leads to downfall.",
  "I choose integrity in all things, even when no one is watching.",
  "I trust that following God’s wisdom brings joy and safety.",
  "I stay steady, grounded, and wise in every situation.",
  "I stay humble and acknowledge my need for God’s wisdom.",
  "I protect my words and avoid speaking without understanding.",
  "I trust in God’s truth because His Word never fails.",
  "I refuse falsehood and deceit in any form.",
  "I ask God for what I truly need, not for excess that harms me.",
  "I remain content with the portion God gives me.",
  "I use discernment to recognize patterns of foolishness.",
  "I walk away from prideful or arrogant behavior.",
  "I stay alert to the lessons hidden in everyday life.",
  "I choose wisdom because it strengthens and stabilizes me.",
  "I speak with wisdom, and kindness flows from my words.",
  "I rise each day with purpose, strength, and dignity.",
  "I manage my responsibilities with clarity and intention.",
  "I make decisions that bring honor to my life and those connected to me.",
  "I stay disciplined because discipline strengthens my future.",
  "I am clothed in strength, not fear or uncertainty.",
  "I protect my household and my heart with wisdom.",
  "I steward my time, energy, and resources responsibly.",
  "I walk in confidence because God equips me for every season.",
  "I live in a way that reflects grace, purpose, and resilience."
];

/* =========================
   STORAGE + HELPERS
   ========================= */

const STORE_KEY = "wellness_app_kjv_proverbs_v1";

function nowISO(){ return new Date().toISOString(); }
function todayLocalISODate(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
function toLocalTimeLabel(iso){
  const d = new Date(iso);
  return d.toLocaleTimeString([], { hour:"numeric", minute:"2-digit" });
}
function toLocalDateTimeLabel(iso){
  const d = new Date(iso);
  return d.toLocaleString([], { year:"numeric", month:"short", day:"numeric", hour:"numeric", minute:"2-digit" });
}
function dayOfYear(date = new Date()){
  const start = new Date(date.getFullYear(), 0, 0);
  const diff = date - start;
  const oneDay = 1000 * 60 * 60 * 24;
  return Math.floor(diff / oneDay);
}
function uid(){
  return Math.random().toString(36).slice(2) + "-" + Date.now().toString(36);
}
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

function loadState(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return freshState();
    const parsed = JSON.parse(raw);
    return migrate(parsed);
  }catch(e){
    return freshState();
  }
}
function freshState(){
  return {
    version: 1,
    viewDate: todayLocalISODate(),
    verseShuffleSeed: 0,
    affShuffleSeed: 0,
    journal: {
      // [date]: { draft: "", entries: [{ts,text}] }
    },
    goals: [
      // {id,text,createdAt,completed:boolean,completedAt:null}
    ],
    moods: {
      // [date]: [{id,ts,dep,anx,note}]
    },
    appointments: [
      // {id,title,datetime,location,notes,createdAt}
    ],
    followups: [
      // {id,name,notes,createdAt,done:boolean,doneAt:null}
    ]
  };
}
function migrate(s){
  // basic guard
  if(!s || typeof s !== "object") return freshState();
  if(!s.version) s.version = 1;
  if(!s.viewDate) s.viewDate = todayLocalISODate();
  if(!s.journal) s.journal = {};
  if(!s.goals) s.goals = [];
  if(!s.moods) s.moods = {};
  if(!s.appointments) s.appointments = [];
  if(!s.followups) s.followups = [];
  if(typeof s.verseShuffleSeed !== "number") s.verseShuffleSeed = 0;
  if(typeof s.affShuffleSeed !== "number") s.affShuffleSeed = 0;
  return s;
}

let STATE = loadState();
let saveTimer = null;

function saveState(showToastMsg){
  localStorage.setItem(STORE_KEY, JSON.stringify(STATE));
    if(showToastMsg) toast(showToastMsg);
}
function scheduleSave(showToastMsg){
  setSaveStatus("Saving…");
  clearTimeout(saveTimer);
  saveTimer = setTimeout(()=>saveState(showToastMsg), 250);
}
function setSaveStatus(txt){
  const el = document.getElementById("saveStatus");
  if(el) el.textContent = txt;
}
function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 1400);
}

/* =========================
   UI BINDINGS
   ========================= */

const elLiveDate = document.getElementById("liveDate");
const elLiveTime = document.getElementById("liveTime");
const elViewDate = document.getElementById("viewDate");
const btnToday = document.getElementById("btnToday");
const btnSaveAll = document.getElementById("btnSaveAll");

const verseRef = document.getElementById("verseRef");
const verseText = document.getElementById("verseText");
const btnNewVerse = document.getElementById("btnNewVerse");

const affText = document.getElementById("affText");
const btnNewAff = document.getElementById("btnNewAff");

const journalInput = document.getElementById("journalInput");
const btnAddJournal = document.getElementById("btnAddJournal");
const btnClearDraft = document.getElementById("btnClearDraft");
const journalList = document.getElementById("journalList");
const journalEmpty = document.getElementById("journalEmpty");
const journalDateLabel = document.getElementById("journalDateLabel");

const goalInput = document.getElementById("goalInput");
const btnAddGoal = document.getElementById("btnAddGoal");
const goalsList = document.getElementById("goalsList");
const goalsEmpty = document.getElementById("goalsEmpty");
const goalsDoneList = document.getElementById("goalsDoneList");
const goalsDoneEmpty = document.getElementById("goalsDoneEmpty");

const depScale = document.getElementById("depScale");
const anxScale = document.getElementById("anxScale");
const mhNote = document.getElementById("mhNote");
const btnAddCheckin = document.getElementById("btnAddCheckin");
const btnClearCheckin = document.getElementById("btnClearCheckin");
const mhList = document.getElementById("mhList");
const mhEmpty = document.getElementById("mhEmpty");
const mhDateLabel = document.getElementById("mhDateLabel");

const apptTitleInput = document.getElementById("apptTitleInput");
const apptDateTimeInput = document.getElementById("apptDateTimeInput");
const apptLocationInput = document.getElementById("apptLocationInput");
const apptNotesInput = document.getElementById("apptNotesInput");
const btnAddAppt = document.getElementById("btnAddAppt");
const btnClearAppt = document.getElementById("btnClearAppt");
const apptList = document.getElementById("apptList");
const apptEmpty = document.getElementById("apptEmpty");

const fuNameInput = document.getElementById("fuNameInput");
const fuNotesInput = document.getElementById("fuNotesInput");
const btnAddFU = document.getElementById("btnAddFU");
const btnClearFU = document.getElementById("btnClearFU");
const fuList = document.getElementById("fuList");
const fuEmpty = document.getElementById("fuEmpty");

const btnExport = document.getElementById("btnExport");
const btnHardReset = document.getElementById("btnHardReset");

/* =========================
   LIVE DATE/TIME
   ========================= */

function tickClock(){
  const d = new Date();
  elLiveDate.textContent = d.toLocaleDateString([], { weekday:"long", year:"numeric", month:"long", day:"numeric" });
  elLiveTime.textContent = d.toLocaleTimeString([], { hour:"numeric", minute:"2-digit", second:"2-digit" });
}
tickClock();
setInterval(tickClock, 1000);

/* =========================
   DAILY SELECTION (Verse + Affirmation)
   - Based on day-of-year + optional shuffle seed
   ========================= */

function getDailyVerseIndex(dateStr){
  const d = new Date(dateStr + "T00:00:00");
  const doy = dayOfYear(d);
  const base = (doy + STATE.verseShuffleSeed) % KJV_VERSES_FEAR.length;
  return clamp(base, 0, KJV_VERSES_FEAR.length - 1);
}
function getDailyAffIndex(dateStr){
  const d = new Date(dateStr + "T00:00:00");
  const doy = dayOfYear(d);
  const base = (doy + STATE.affShuffleSeed) % AFFIRMATIONS_365.length;
  return clamp(base, 0, AFFIRMATIONS_365.length - 1);
}

function renderDailyVerse(){
  const idx = getDailyVerseIndex(STATE.viewDate);
  const v = KJV_VERSES_FEAR[idx];
  verseRef.textContent = v ? v.ref : "—";
  verseText.textContent = v ? v.text : "—";
}
function renderDailyAff(){
  const idx = getDailyAffIndex(STATE.viewDate);
  const a = AFFIRMATIONS_365[idx];
  affText.textContent = a || "—";
}

/* =========================
   JOURNAL
   ========================= */

function ensureJournal(dateStr){
  if(!STATE.journal[dateStr]) STATE.journal[dateStr] = { draft:"", entries:[] };
  if(!Array.isArray(STATE.journal[dateStr].entries)) STATE.journal[dateStr].entries = [];
  if(typeof STATE.journal[dateStr].draft !== "string") STATE.journal[dateStr].draft = "";
}
function renderJournal(){
  const d = STATE.viewDate;
  ensureJournal(d);
  journalDateLabel.textContent = d;
  journalInput.value = STATE.journal[d].draft || "";

  const entries = STATE.journal[d].entries.slice().sort((a,b)=> (a.ts>b.ts? -1 : 1));
  journalList.innerHTML = "";
  if(entries.length === 0){
    journalEmpty.style.display = "block";
    return;
  }
  journalEmpty.style.display = "none";
  for(const e of entries){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div style="white-space:pre-wrap;">${escapeHTML(e.text)}</div>
        <div class="meta">${toLocalTimeLabel(e.ts)}</div>
      </div>
      <div class="actions">
        <button class="danger" data-del="${e.id}">Delete</button>
      </div>
    `;
    journalList.appendChild(div);
  }
  journalList.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-del");
      STATE.journal[d].entries = STATE.journal[d].entries.filter(x=>x.id !== id);
      scheduleSave("Deleted");
      renderJournal();
    });
  });
}

journalInput.addEventListener("input", ()=>{
  ensureJournal(STATE.viewDate);
  STATE.journal[STATE.viewDate].draft = journalInput.value;
  scheduleSave();
});

btnAddJournal.addEventListener("click", ()=>{
  const txt = (journalInput.value || "").trim();
  if(!txt){ toast("Write something first"); return; }
  ensureJournal(STATE.viewDate);
  STATE.journal[STATE.viewDate].entries.push({ id: uid(), ts: nowISO(), text: txt });
  STATE.journal[STATE.viewDate].draft = "";
  journalInput.value = "";
  scheduleSave("Journal entry saved");
  renderJournal();
});

btnClearDraft.addEventListener("click", ()=>{
  ensureJournal(STATE.viewDate);
  STATE.journal[STATE.viewDate].draft = "";
  journalInput.value = "";
  scheduleSave("Draft cleared");
});

/* =========================
   GOALS (carry forward until completed)
   ========================= */

function renderGoals(){
  const active = STATE.goals.filter(g=>!g.completed).sort((a,b)=> (a.createdAt > b.createdAt ? -1 : 1));
  const done = STATE.goals.filter(g=>g.completed).sort((a,b)=> (a.completedAt > b.completedAt ? -1 : 1));

  goalsList.innerHTML = "";
  goalsDoneList.innerHTML = "";

  goalsEmpty.style.display = active.length ? "none" : "block";
  goalsDoneEmpty.style.display = done.length ? "none" : "block";

  for(const g of active){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div style="display:flex; gap:10px; align-items:flex-start;">
          <input type="checkbox" data-done="${g.id}" style="margin-top:3px; transform:scale(1.2);" />
          <div style="white-space:pre-wrap; flex:1;">${escapeHTML(g.text)}</div>
        </div>
        <div class="meta">Added: ${toLocalDateTimeLabel(g.createdAt)}</div>
      </div>
      <div class="actions">
        <button class="danger" data-del="${g.id}">Delete</button>
      </div>
    `;
    goalsList.appendChild(div);
  }

  for(const g of done){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div style="white-space:pre-wrap; text-decoration: line-through;">${escapeHTML(g.text)}</div>
        <div class="meta">Completed: ${g.completedAt ? toLocalDateTimeLabel(g.completedAt) : "—"}</div>
      </div>
      <div class="actions">
        <button data-undo="${g.id}">Undo</button>
        <button class="danger" data-del="${g.id}">Delete</button>
      </div>
    `;
    goalsDoneList.appendChild(div);
  }

  goalsList.querySelectorAll("input[data-done]").forEach(cb=>{
    cb.addEventListener("change", ()=>{
      const id = cb.getAttribute("data-done");
      const goal = STATE.goals.find(x=>x.id === id);
      if(goal){
        goal.completed = true;
        goal.completedAt = nowISO();
        scheduleSave("Goal completed");
        renderGoals();
      }
    });
  });

  document.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-del");
      // careful: this selector exists in multiple sections; scope by checking parent containers
      if(btn.closest("#goalsList") || btn.closest("#goalsDoneList")){
        STATE.goals = STATE.goals.filter(x=>x.id !== id);
        scheduleSave("Deleted");
        renderGoals();
      }
    });
  });

  goalsDoneList.querySelectorAll("button[data-undo]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-undo");
      const goal = STATE.goals.find(x=>x.id === id);
      if(goal){
        goal.completed = false;
        goal.completedAt = null;
        scheduleSave("Restored");
        renderGoals();
      }
    });
  });
}

btnAddGoal.addEventListener("click", ()=>{
  const txt = (goalInput.value || "").trim();
  if(!txt){ toast("Type a goal first"); return; }
  STATE.goals.push({ id: uid(), text: txt, createdAt: nowISO(), completed:false, completedAt:null });
  goalInput.value = "";
  scheduleSave("Goal added");
  renderGoals();
});

/* =========================
   MENTAL HEALTH CHECK-INS (1–10 buttons)
   ========================= */

let currentDep = null;
let currentAnx = null;

function buildScale(container, onPick){
  container.innerHTML = "";
  for(let i=1;i<=10;i++){
    const b = document.createElement("div");
    b.className = "numBtn";
    b.textContent = String(i);
    b.setAttribute("role","button");
    b.setAttribute("tabindex","0");
    b.addEventListener("click", ()=> onPick(i));
    b.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); onPick(i); } });
    container.appendChild(b);
  }
}
function setScaleSelected(container, val){
  container.querySelectorAll(".numBtn").forEach(btn=>{
    const n = Number(btn.textContent);
    btn.classList.toggle("sel", n === val);
  });
}

buildScale(depScale, (n)=>{ currentDep = n; setScaleSelected(depScale, n); });
buildScale(anxScale, (n)=>{ currentAnx = n; setScaleSelected(anxScale, n); });

function ensureMoods(dateStr){
  if(!STATE.moods[dateStr]) STATE.moods[dateStr] = [];
  if(!Array.isArray(STATE.moods[dateStr])) STATE.moods[dateStr] = [];
}
function renderMoods(){
  const d = STATE.viewDate;
  ensureMoods(d);
  mhDateLabel.textContent = d;

  const entries = STATE.moods[d].slice().sort((a,b)=> (a.ts>b.ts? -1 : 1));
  mhList.innerHTML = "";
  if(entries.length === 0){
    mhEmpty.style.display = "block";
    return;
  }
  mhEmpty.style.display = "none";

  for(const e of entries){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div><b>Depression:</b> ${e.dep} &nbsp;&nbsp; <b>Anxiety:</b> ${e.anx}</div>
        ${e.note ? `<div style="white-space:pre-wrap; margin-top:6px;">${escapeHTML(e.note)}</div>` : ""}
        <div class="meta">${toLocalTimeLabel(e.ts)}</div>
      </div>
      <div class="actions">
        <button class="danger" data-del-mh="${e.id}">Delete</button>
      </div>
    `;
    mhList.appendChild(div);
  }

  mhList.querySelectorAll("button[data-del-mh]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-del-mh");
      STATE.moods[d] = STATE.moods[d].filter(x=>x.id !== id);
      scheduleSave("Deleted");
      renderMoods();
    });
  });
}

btnAddCheckin.addEventListener("click", ()=>{
  if(currentDep === null || currentAnx === null){
    toast("Pick Depression and Anxiety (1–10)");
    return;
  }
  const note = (mhNote.value || "").trim();
  const d = STATE.viewDate;
  ensureMoods(d);
  STATE.moods[d].push({ id: uid(), ts: nowISO(), dep: currentDep, anx: currentAnx, note });
  mhNote.value = "";
  scheduleSave("Check-in saved");
  renderMoods();
});

btnClearCheckin.addEventListener("click", ()=>{
  currentDep = null;
  currentAnx = null;
  mhNote.value = "";
  setScaleSelected(depScale, -1);
  setScaleSelected(anxScale, -1);
  toast("Cleared");
});

/* =========================
   APPOINTMENTS
   ========================= */

function renderAppointments(){
  apptList.innerHTML = "";
  const list = STATE.appointments.slice().sort((a,b)=> (a.datetime > b.datetime ? 1 : -1));
  apptEmpty.style.display = list.length ? "none" : "block";
  for(const a of list){
    const when = a.datetime ? new Date(a.datetime).toLocaleString([], { year:"numeric", month:"short", day:"numeric", hour:"numeric", minute:"2-digit" }) : "—";
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div><b>${escapeHTML(a.title || "Untitled")}</b></div>
        <div class="meta">${when}${a.location ? " • " + escapeHTML(a.location) : ""}</div>
        ${a.notes ? `<div style="white-space:pre-wrap; margin-top:6px;">${escapeHTML(a.notes)}</div>` : ""}
      </div>
      <div class="actions">
        <button data-edit-appt="${a.id}">Edit</button>
        <button class="danger" data-del-appt="${a.id}">Delete</button>
      </div>
    `;
    apptList.appendChild(div);
  }

  apptList.querySelectorAll("button[data-del-appt]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-del-appt");
      STATE.appointments = STATE.appointments.filter(x=>x.id !== id);
      scheduleSave("Deleted");
      renderAppointments();
    });
  });

  apptList.querySelectorAll("button[data-edit-appt]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-edit-appt");
      const a = STATE.appointments.find(x=>x.id === id);
      if(!a) return;
      apptTitleInput.value = a.title || "";
      apptDateTimeInput.value = a.datetime || "";
      apptLocationInput.value = a.location || "";
      apptNotesInput.value = a.notes || "";
      // store editing id on button dataset
      btnAddAppt.dataset.editing = id;
      btnAddAppt.textContent = "Save Changes";
      toast("Editing appointment");
    });
  });
}

btnAddAppt.addEventListener("click", ()=>{
  const title = (apptTitleInput.value || "").trim();
  const datetime = apptDateTimeInput.value || "";
  const location = (apptLocationInput.value || "").trim();
  const notes = (apptNotesInput.value || "").trim();

  if(!title && !datetime){
    toast("Add a title or date/time");
    return;
  }

  const editingId = btnAddAppt.dataset.editing;
  if(editingId){
    const a = STATE.appointments.find(x=>x.id === editingId);
    if(a){
      a.title = title;
      a.datetime = datetime;
      a.location = location;
      a.notes = notes;
      scheduleSave("Appointment updated");
    }
    delete btnAddAppt.dataset.editing;
    btnAddAppt.textContent = "Add Appointment";
  }else{
    STATE.appointments.push({ id: uid(), title, datetime, location, notes, createdAt: nowISO() });
    scheduleSave("Appointment added");
  }

  clearApptInputs();
  renderAppointments();
});

function clearApptInputs(){
  apptTitleInput.value = "";
  apptDateTimeInput.value = "";
  apptLocationInput.value = "";
  apptNotesInput.value = "";
  delete btnAddAppt.dataset.editing;
  btnAddAppt.textContent = "Add Appointment";
}
btnClearAppt.addEventListener("click", ()=>{
  clearApptInputs();
  toast("Cleared");
});

/* =========================
   FOLLOW-UPS
   ========================= */

function renderFollowups(){
  fuList.innerHTML = "";
  const list = STATE.followups.slice().sort((a,b)=> (a.createdAt > b.createdAt ? -1 : 1));
  fuEmpty.style.display = list.length ? "none" : "block";

  for(const f of list){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <div style="display:flex; gap:10px; align-items:flex-start;">
          <input type="checkbox" ${f.done ? "checked" : ""} data-fu-done="${f.id}" style="margin-top:3px; transform:scale(1.2);" />
          <div style="flex:1;">
            <div><b>${escapeHTML(f.name || "Unnamed contact")}</b></div>
            ${f.notes ? `<div style="white-space:pre-wrap; margin-top:6px;">${escapeHTML(f.notes)}</div>` : ""}
            <div class="meta">${f.done ? "Done: " + (f.doneAt ? toLocalDateTimeLabel(f.doneAt) : "") : "Added: " + toLocalDateTimeLabel(f.createdAt)}</div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button data-edit-fu="${f.id}">Edit</button>
        <button class="danger" data-del-fu="${f.id}">Delete</button>
      </div>
    `;
    fuList.appendChild(div);
  }

  fuList.querySelectorAll("input[data-fu-done]").forEach(cb=>{
    cb.addEventListener("change", ()=>{
      const id = cb.getAttribute("data-fu-done");
      const f = STATE.followups.find(x=>x.id === id);
      if(!f) return;
      f.done = cb.checked;
      f.doneAt = cb.checked ? nowISO() : null;
      scheduleSave(cb.checked ? "Marked done" : "Marked not done");
      renderFollowups();
    });
  });

  fuList.querySelectorAll("button[data-del-fu]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-del-fu");
      STATE.followups = STATE.followups.filter(x=>x.id !== id);
      scheduleSave("Deleted");
      renderFollowups();
    });
  });

  fuList.querySelectorAll("button[data-edit-fu]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-edit-fu");
      const f = STATE.followups.find(x=>x.id === id);
      if(!f) return;
      fuNameInput.value = f.name || "";
      fuNotesInput.value = f.notes || "";
      btnAddFU.dataset.editing = id;
      btnAddFU.textContent = "Save Changes";
      toast("Editing follow-up");
    });
  });
}

btnAddFU.addEventListener("click", ()=>{
  const name = (fuNameInput.value || "").trim();
  const notes = (fuNotesInput.value || "").trim();
  if(!name && !notes){
    toast("Add a name or a note");
    return;
  }

  const editingId = btnAddFU.dataset.editing;
  if(editingId){
    const f = STATE.followups.find(x=>x.id === editingId);
    if(f){
      f.name = name;
      f.notes = notes;
      scheduleSave("Follow-up updated");
    }
    delete btnAddFU.dataset.editing;
    btnAddFU.textContent = "Add Follow-up";
  }else{
    STATE.followups.push({ id: uid(), name, notes, createdAt: nowISO(), done:false, doneAt:null });
    scheduleSave("Follow-up added");
  }

  clearFUInputs();
  renderFollowups();
});

function clearFUInputs(){
  fuNameInput.value = "";
  fuNotesInput.value = "";
  delete btnAddFU.dataset.editing;
  btnAddFU.textContent = "Add Follow-up";
}
btnClearFU.addEventListener("click", ()=>{
  clearFUInputs();
  toast("Cleared");
});

/* =========================
   VIEW DATE CONTROL
   ========================= */

function renderAll(){
  elViewDate.value = STATE.viewDate;
  renderDailyVerse();
  renderDailyAff();
  renderJournal();
  renderGoals();
  renderMoods();
  renderAppointments();
  renderFollowups();
}

elViewDate.addEventListener("change", ()=>{
  const v = elViewDate.value;
  if(!v) return;
  STATE.viewDate = v;
  scheduleSave();
  renderAll();
});

btnToday.addEventListener("click", ()=>{
  STATE.viewDate = todayLocalISODate();
  elViewDate.value = STATE.viewDate;
  scheduleSave("Today");
  renderAll();
});

btnSaveAll.addEventListener("click", ()=>{
  saveState("Saved");
});

/* =========================
   "SHOW ANOTHER" (Verse/Aff)
   This changes the seed (so daily pick shifts),
   but still stays stable until you change it again.
   ========================= */

btnNewVerse.addEventListener("click", ()=>{
  STATE.verseShuffleSeed = (STATE.verseShuffleSeed + 1) % 100000;
  scheduleSave("New verse shown");
  renderDailyVerse();
});

btnNewAff.addEventListener("click", ()=>{
  STATE.affShuffleSeed = (STATE.affShuffleSeed + 1) % 100000;
  scheduleSave("New affirmation shown");
  renderDailyAff();
});

/* =========================
   EXPORT + HARD RESET
   ========================= */

btnExport.addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify(STATE, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `wellness-app-backup-${STATE.viewDate}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  toast("Exported JSON");
});

btnHardReset.addEventListener("click", ()=>{
  const ok = confirm("This will permanently delete all saved data on this device. Continue?");
  if(!ok) return;
  localStorage.removeItem(STORE_KEY);
  STATE = freshState();
  currentDep = null; currentAnx = null;
  setScaleSelected(depScale, -1);
  setScaleSelected(anxScale, -1);
  toast("All data deleted");
  renderAll();
  saveState();
});

/* =========================
   UTIL
   ========================= */

function escapeHTML(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   INITIAL RENDER
   ========================= */

renderAll();

/* Optional: quick duplicate check in console */
(function duplicateCheck(){
  const seen = new Set();
  const dups = [];
  for(const v of KJV_VERSES_FEAR){
    const k = v.ref.trim().toLowerCase();
    if(seen.has(k)) dups.push(v.ref);
    seen.add(k);
  }
  if(dups.length){
    console.warn("Duplicate verse references:", dups);
  }
})();
</script>
  <button class="fabSave" id="btnSaveAll" title="Save">Save</button>
</body>
</html>
